<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Kikusuiro Indoor Map / ËèäÊ∞¥Ê•º Â±ãÂÜÖ„Éû„ÉÉ„Éó</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- Swiper -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: "Hiragino Sans", "Noto Sans JP", sans-serif;
    }

    #map { height: 100vh; width: 100%; }

    .lang-toggle {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid #ccc;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      z-index: 9999;
      transition: all 0.2s;
    }
    .lang-toggle:hover {
      background: #f0f0f0;
    }

    .popup-content {
      max-width: 300px;
      font-size: 15px;
      line-height: 1.5;
    }

    .swiper {
      width: 260px;
      height: 180px;
      margin-bottom: 8px;
    }

    .swiper-slide img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 8px;
      cursor: pointer;
    }

    .img-hint {
      font-size: 13px;
      color: #777;
      text-align: center;
      margin-bottom: 6px;
    }

    #modal {
      display: none;
      position: fixed;
      z-index: 9999;
      left: 0; top: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.85);
      justify-content: center;
      align-items: center;
    }

    #modal img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 10px;
    }

    @media (max-width: 600px) {
      .popup-content { max-width: 90vw; font-size: 14px; }
      .swiper { width: 85vw; height: 55vw; }
      .img-hint { font-size: 12px; }
      .lang-toggle { font-size: 13px; padding: 5px 10px; }
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <button class="lang-toggle" id="langToggle">EN / Êó•Êú¨Ë™û</button>

  <div id="modal" onclick="this.style.display='none'">
    <img src="" alt="">
  </div>

  <script>
    // ===== Ë®ÄË™ûË®≠ÂÆö =====
    let lang = (navigator.language || navigator.userLanguage).startsWith('ja') ? 'ja' : 'en';

    const langButton = document.getElementById("langToggle");
    langButton.addEventListener("click", () => {
      lang = lang === "ja" ? "en" : "ja";
      alert(lang === "ja" ? "Êó•Êú¨Ë™û„É¢„Éº„Éâ„Å´Âàá„ÇäÊõø„Åà„Åæ„Åó„Åü„ÄÇ" : "Switched to English mode.");
      map.eachLayer(layer => { if (layer instanceof L.Marker) map.removeLayer(layer); });
      addMarkers();
    });

    // ===== Âú∞Âõ≥Ë®≠ÂÆö =====
    const map = L.map('map', { crs: L.CRS.Simple, minZoom: -1, maxZoom: 2 });
    const mapWidth = 2000, mapHeight = 1500;
    const bounds = [[0, 0], [mapHeight, mapWidth]];
    L.imageOverlay('kikusui_map.png', bounds).addTo(map);
    map.fitBounds(bounds);

    // ===== ÈÉ®Â±ã„Éá„Éº„Çø =====
    const rooms = [
      {
        name: { ja: "ÁéÑÈñ¢", en: "Entrance" },
        coords: [1150, 1010],
        desc: {
          ja: "„Çà„ÅÜ„Åì„ÅùËèäÊ∞¥Ê•º„Å∏„ÄÇÁéÑÈñ¢Ê®™„Å´Ë≤º„Çâ„Çå„Å¶„ÅÑ„ÇãÈÄÜ„ÅïÂêë„Åç„ÅÆÊú≠„Å´„ÅØÁü≥Â∑ù‰∫îÂè≥Ë°õÈñÄ„ÅÆÂëΩÊó•„ÅåÊõ∏„Åã„Çå„Å¶„Åä„Çä„ÄÅ„Åì„Çå„ÅØÊ≥•Ê£íÈô§„Åë„Å®„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
          en: "Welcome to Kikusuiro. The upside-down plaque near the entrance bears the death date of Ishikawa Goemon, a famous thief, believed to ward off burglars."
        },
        img: ["IMG_0377.jpeg"]
      },
      {
        name: { ja: "‰∏ãÂ∫ÉÈñì", en: "Lower Hall" },
        coords: [1050, 950],
        desc: {
          ja: "Èπø„ÅÆÂΩ´Âàª„ÇÑÊ≠£Èù¢„ÅÆÂ£Å„Å´È£æ„Çâ„Çå„Å¶„ÅÑ„ÇãÊõ∏ÈÅì„ÅåÁâπÂæ¥ÁöÑ„Åß„Åô„ÄÇÊù±ÂÅ¥„ÅÆÊ£ö„Å´„ÅØËèäÊ∞¥Ê•º„ÅßÁµêÂ©öÂºè„ÇíÊåô„Åí„ÅüÊñπ„ÄÖ„Åå‰Ωú„Çã„ÄåÁµê„Äç„Å®„ÅÑ„ÅÜÂ∑ªÁâ©„ÅåÈ£æ„Çâ„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
          en: "This room features a deer sculpture and calligraphy on the front wall. On the east shelf, you can see 'Yui', scrolls created by couples married at Kikusuiro."
        },
        img: ["IMG_0378.jpeg", "IMG_0379.jpeg", "IMG_0376.jpeg", "IMG_0380.jpeg"]
      },
      {
        name: { ja: "„Ç™„É™„Ç®„É≥„Çø„É´„É´„Éº„É†", en: "Oriental Room" },
        coords: [850, 300],
        desc: {
          ja: "ÂÆ¥‰ºö„ÉªÊä´Èú≤ÂÆ¥„Å´‰ΩøÁî®„Åï„Çå„Åæ„Åô„ÄÇ‰∏≠ËèØÈ¢®„ÅÆÁÖßÊòé„ÇÑÈäÖÈëº„ÄÅ„Éì„É™„É§„Éº„ÉâÂè∞„Å™„Å©Êßò„ÄÖ„Å™ÊñáÂåñ„ÅåÊ∑∑Âêà„Åó„Å¶„ÅÑ„ÇãÂÜÖË£Ö„ÅåÁâπÂæ¥ÁöÑ„Åß„Åô„ÄÇ",
          en: "Used for banquets and receptions. Its d√©cor mixes cultures with Chinese-style lamps, a gong, and a billiard table."
        },
        img: ["IMG_0382.jpeg"]
      },
      {
        name: { ja: "Êò•Êó•„ÅÆÈñì", en: "Kasuga Room" },
        coords: [700, 1575],
        desc: {
          ja: "„Åì„ÅÆÈÉ®Â±ã„ÅÆ‰∏≠Â§ÆÈÉ®Ë•øÂÅ¥„ÅÆÂ£Å„Å´„ÅÇ„ÇãÊü±„ÅØÊòéÊ≤ªÁ∂≠Êñ∞Âæå„ÅÆÂªÉ‰ªèÊØÄÈáàÈÅãÂãï„ÅÆÊôÇ„Å´ÂØ∫„Åã„ÇâÂºï„ÅçÂèñ„Å£„Åü„ÇÇ„ÅÆ„Åß„Åô„ÄÇ",
          en: "The pillar on the west wall was brought from a temple during the anti-Buddhist movement after the Meiji Restoration."
        },
        img: ["IMG_0381.jpeg"]
      }
    ];

    // ===== „É¢„Éº„ÉÄ„É´Ë°®Á§∫ =====
    function openModal(src) {
      const modal = document.getElementById('modal');
      modal.style.display = 'flex';
      modal.querySelector('img').src = src;
    }

    // ===== „Éî„É≥Ë®≠ÁΩÆÈñ¢Êï∞ =====
    function addMarkers() {
      rooms.forEach((room, i) => {
        const marker = L.marker(room.coords).addTo(map);
        marker.on('click', () => {
          const popupContent = `
            <div class="popup-content">
              <h3>${room.name[lang]}</h3>
              <div class="swiper swiper${i}">
                <div class="swiper-wrapper">
                  ${room.img.map(src => `
                    <div class="swiper-slide">
                      <img src="${src}" alt="${room.name[lang]}" onclick="openModal('${src}')">
                    </div>`).join('')}
                </div>
                <div class="swiper-pagination"></div>
                <div class="swiper-button-prev"></div>
                <div class="swiper-button-next"></div>
              </div>
              <div class="img-hint">üì∑ ${
                lang === 'ja'
                  ? 'ÁîªÂÉè„Çí„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Å®Êã°Â§ßË°®Á§∫„Åï„Çå„Åæ„Åô'
                  : 'Tap an image to enlarge'
              }</div>
              <p>${room.desc[lang]}</p>
            </div>
          `;
          marker.bindPopup(popupContent).openPopup();

          setTimeout(() => {
            document.querySelectorAll(".swiper").forEach(sw => {
              if (sw.swiper) sw.swiper.destroy(true, true);
            });
            new Swiper(`.swiper${i}`, {
              pagination: { el: `.swiper${i} .swiper-pagination`, clickable: true },
              navigation: {
                nextEl: `.swiper${i} .swiper-button-next`,
                prevEl: `.swiper${i} .swiper-button-prev`
              }
            });
          }, 100);
        });
      });
    }

    // ÂàùÂõû„É≠„Éº„ÉâÊôÇ„Å´ËøΩÂä†
    addMarkers();
  </script>
</body>
</html>
