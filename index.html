<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>菊水楼 屋内マップ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet 読み込み -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- 画像スライダー用 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>

  <style>
    body {
      margin: 0;
      font-family: "Hiragino Sans", "Noto Sans JP", sans-serif;
    }
    #map {
      height: 100vh;
      width: 100%;
    }

    /* Leafletポップアップ内のレイアウト */
    .popup-content {
      max-width: 260px;
    }
    .swiper {
      width: 240px;
      height: 180px;
      margin-bottom: 8px;
    }
    .swiper-slide img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 6px;
      cursor: pointer;
    }

    /* 拡大用モーダル */
    #modal {
      display: none;
      position: fixed;
      z-index: 10000;
      left: 0; top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      justify-content: center;
      align-items: center;
    }
    #modal img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 8px;
    }
  </style>
</head>

<body>
  <div id="map"></div>

  <!-- 拡大画像モーダル -->
  <div id="modal" onclick="this.style.display='none'">
    <img src="" alt="">
  </div>

  <script>
    // === 地図初期化 ===
    const map = L.map('map', {
      crs: L.CRS.Simple,
      minZoom: -1,
      maxZoom: 2
    });

    // === 画像を背景に設定 ===
    const mapWidth = 2000;  // 画像の実際のサイズに合わせて調整
    const mapHeight = 1500;
    const bounds = [[0, 0], [mapHeight, mapWidth]];
    L.imageOverlay('kikusui_map.png', bounds).addTo(map);
    map.fitBounds(bounds);

    // === 各部屋データ ===
    const rooms = [
      {
        name: "玄関",
        coords: [800, 1010],
        desc: "ようこそ菊水楼へ。玄関横に貼られている逆さ向きの札には石川五右衛門の命日が書かれており、これは泥棒除けとされています。",
        img: ["IMG_0377.jpeg"]
      },
      {
        name: "下広間",
        coords: [780, 950],
        desc: "鹿の彫刻や正面の壁に飾られている書道が特徴的です。東側の棚には菊水楼で結婚式を挙げた方々が作る「結」という巻物が飾られています。",
        img: ["IMG_0378.jpeg", "IMG_0379.jpeg", "IMG_0376.jpeg", "IMG_0380.jpeg", "IMG_0383.png"]
      },
      {
        name: "オリエンタルルーム",
        coords: [650, 300],
        desc: "宴会・披露宴に使用されます。中華風の照明や銅鑼、ビリヤード台など様々な文化が混合している内装が特徴的です。",
        img: ["IMG_0382.jpeg"]
      },
      {
        name: "春日の間",
        coords: [500, 1575],
        desc: "この部屋の中央部西側の壁にある柱は明治維新後の廃仏毀釈運動の時に寺から引き取ったものです。",
        img: ["IMG_0381.jpeg"]
      }
    ];

    // === ピン追加 ===
    rooms.forEach((room, i) => {
      const marker = L.marker(room.coords).addTo(map);
      marker.on('click', () => {
        const popupContent = `
          <div class="popup-content">
            <h3>${room.name}</h3>
            <div class="swiper swiper${i}">
              <div class="swiper-wrapper">
                ${room.img.map(src => `
                  <div class="swiper-slide">
                    <img src="${src}" alt="${room.name}" onclick="openModal('${src}')">
                  </div>`).join("")}
              </div>
              <div class="swiper-pagination"></div>
              <div class="swiper-button-prev"></div>
              <div class="swiper-button-next"></div>
            </div>
            <p>${room.desc}</p>
          </div>
        `;
        marker.bindPopup(popupContent).openPopup();

        // Swiperを再初期化
        setTimeout(() => {
          new Swiper(`.swiper${i}`, {
            pagination: { el: '.swiper-pagination', clickable: true },
            navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
          });
        }, 100);
      });
    });

    // === モーダル表示関数 ===
    function openModal(src) {
      const modal = document.getElementById('modal');
      modal.style.display = 'flex';
      modal.querySelector('img').src = src;
    }
  </script>
</body>
</html>
