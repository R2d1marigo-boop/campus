<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>菊水楼 屋内マップ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    html, body, #map { height: 100%; margin: 0; padding: 0; }
    .leaflet-popup-content {
      font-size: 14px;
      line-height: 1.4;
    }
    .room-img {
      width: 180px;
      border-radius: 8px;
      margin-top: 6px;
    }
    /* --- スライダー部分のスタイル --- */
    .slider {
      position: relative;
      width: 180px;
      height: 120px;
      overflow: hidden;
      border-radius: 8px;
      margin-top: 6px;
    }
    .slides {
      display: flex;
      transition: transform 0.5s ease;
    }
    .slides img {
      width: 180px;
      height: 120px;
      object-fit: cover;
    }
    .prev, .next {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.4);
      color: white;
      border: none;
      cursor: pointer;
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 3px;
    }
    .prev { left: 4px; }
    .next { right: 4px; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    // --- 部屋情報 ---
    const rooms = [
      {
        name: "玄関",
        coords: [930, 1010],
        desc: "ようこそ菊水楼へ。玄関横に貼られている逆さ向きの札には石川五右衛門の命日が書かれており、これは泥棒除けとされています。",
        img: ["genkan.jpg"]
      },
      {
        name: "下広間",
        coords: [830, 950],
        desc: "鹿の彫刻や正面の壁に飾られている書道が特徴的です。東側の棚には菊水楼で結婚式を挙げた方々が作る「結」という巻物が飾られています。",
        img: ["hiro1.jpg", "hiro2.jpg", "hiro3.jpg"]
      },
      {
        name: "オリエンタルルーム",
        coords: [700, 300],
        desc: "宴会・披露宴に使用されます。中華風の照明や銅鑼、ビリヤード台など様々な文化が混合している内装が特徴的です。",
        img: ["oriental.jpg"]
      },
      {
        name: "春日の間",
        coords: [550, 1575],
        desc: "この部屋の中央部西側の壁にある柱は明治維新後の廃仏毀釈運動の時に寺から引き取ったものです。",
        img: ["kasuga.jpg"]
      }
    ];

    const w = 2000, h = 1200;
    const bounds = [[0,0],[h,w]];

    // --- マップ初期化 ---
    const map = L.map('map', {
      crs: L.CRS.Simple,
      minZoom: -1,
      zoomSnap: 0.1
    });

    // 背景画像（屋内マップ）
    L.imageOverlay('kikusui_map.png', bounds).addTo(map);
    map.fitBounds(bounds);
    window.addEventListener('resize', () => map.fitBounds(bounds));

    // --- マーカー生成 ---
    rooms.forEach((r, index) => {
      let popupContent = `<b>${r.name}</b><br>${r.desc}<br>`;

      // 画像が複数ならスライダーにする
      if (r.img.length > 1) {
        const sliderId = `slider-${index}`;
        popupContent += `
          <div class="slider" id="${sliderId}">
            <div class="slides">
              ${r.img.map(src => `<img src="${src}" alt="${r.name}">`).join("")}
            </div>
            <button class="prev">‹</button>
            <button class="next">›</button>
          </div>
        `;
      } else {
        popupContent += `<img src="${r.img[0]}" alt="${r.name}" class="room-img">`;
      }

      const marker = L.marker(r.coords).addTo(map).bindPopup(popupContent);

      // スライダー動作を追加
      marker.on('popupopen', () => {
        if (r.img.length > 1) {
          const popup = document.querySelector(`#slider-${index}`);
          const slides = popup.querySelector('.slides');
          const prev = popup.querySelector('.prev');
          const next = popup.querySelector('.next');
          let current = 0;

          prev.onclick = () => {
            current = (current - 1 + r.img.length) % r.img.length;
            slides.style.transform = `translateX(-${180 * current}px)`;
          };
          next.onclick = () => {
            current = (current + 1) % r.img.length;
            slides.style.transform = `translateX(-${180 * current}px)`;
          };
        }
      });
    });
  </script>
</body>
</html>
